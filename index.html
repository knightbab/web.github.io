<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open and Monitor Window</title>
    <a href = "http://192.168.137.1:3002/" target="_self">打开新窗口</a> </br>
    <a href = "https://www.baidu.com/" id="myLink" target="_self">打开百度</a> </br>
    <a href = "https://cross-origin-isolation.glitch.me/coop?coop=same-origin&" target="_self">打开sameorigin</a> </br>
    <a href = "https://cross-origin-isolation.glitch.me/coop?coop=unsafe-none&" target="_self">打开unsafe-none</a> </br>
    <script>
        function openAndMonitorWindow() {
            // 打开新窗口
            const url = "https://cross-origin-isolation.glitch.me/coop?coop=same-origin&";
            var newWindow = window.open(url, '_blank');
            document.getElementById("content").innerText = "新页面加载中";
            setTimeout(function () {
                document.getElementById("content").innerText = "开始获取opener";
                var targetWindow = newWindow.window;
                document.getElementById("content").innerText = "获取到windows了";
                var sourceWindow = targetWindow.opener;
                if (sourceWindow ===null) {
                    document.getElementById("content").innerText = "获取不到opener了";
                }
                document.getElementById("contentDisplay").innerText = "获取新页面内容中";
                    const content = newWindow.document.body.innerHTML;
                document.getElementById("contentDisplay").innerText = " ";
                    // 如果获取成功，将内容显示在当前页面
                    document.getElementById("contentDisplay").innerText = content;
            }, 30000)
        }
  document.getElementById('myLink').addEventListener('click', function(event) {
    event.preventDefault(); // 阻止默认行为
    window.location.href = this.href; // 手动跳转到目标地址
  });
    </script>
</head>
<body>
    <h1>Open and Monitor Window</h1>
    <button onclick="openAndMonitorWindow()">Open Window</button>
    <div id="contentDisplay" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px;">
        点击按钮打开窗口并获取内容
    </div>
    <div id="content" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px;">
        页面加载结果
    </div>
</body>
</html>
